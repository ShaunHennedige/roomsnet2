<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ROOMSNET</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts Link For Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
    <script src="script.js" defer></script>
</head>
<body class="fullwidth">
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!-- Navigation | START -->
    <a href="index.html">
    <img src="system/images/white.png" 
     alt="" style="width: 150px; height: auto; padding: 0px; margin: 0px; 
     position: fixed; top: 20px; left: 20px; z-index: 1000;">
    </a>
    <!-- Navigation | END -->
    <div id="container">
        <!-- Header | START -->
        <header>
            <!-- Featured Slider | START -->
            <div id="featured">
    
                <!-- Buttons for choosing client type -->
                <div class="client-type">
                    <img id="hotelLogo" alt="Hotel Logo" style="width: 120px; height: auto;">
                    <h2 id="hotelName">Welcome to Test Hotel <br> Hotel ID: Test ID</h2>
                    <p>Select Your Nationality:</p>
                    <button class="btn btn-primary" onclick="handleLocal()" style="margin: 0 10px;">Resident</button>
                    <button class="btn btn-primary" onclick="window.location.href = 'checkavailabilityforeign.html';" style="margin: 0 10px;">Non-Resident</button>
                </div>
                <!-- Form for entering National ID and DOB -->
                <div id="residentForm" class="form-container" style="display: none;">
                    <form onsubmit="return handleFormSubmit(event)" class="p-4 border rounded bg-light">
                        <div class="form-group">
                            <label for="nationalId">National ID:</label>
                            <input type="text" class="form-control nic-validate" id="nationalId" placeholder="Enter National ID">
                            <small class="form-text text-danger nic-validate-error"></small>
                        </div>
                        <div class="form-group">
                            <label for="dob">Date of Birth:</label>
                            <input type="date" class="form-control" id="dob">
                            <span class="error-message" id="dobError" style="display: none;">Please enter your Date of Birth.</span>
                        </div>
                        <div class="form-group">
                            <h6 class="text-left text-success nic-birthday"></h6>
                            <h6 class="text-left text-info nic-gender"></h6>
                        </div>
                        <button type="submit" class="btn btn-primary nic-validate-btn">Submit</button>
                        <button type="button" class="btn btn-warning nic-clear-btn">Clear</button>
                    </form>
                </div>
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img class="d-block w-100" src="system/images/location-6.jpg" alt="First slide">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="system/images/location-4.jpg" alt="Second slide">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="system/images/location-7.jpg" alt="Third slide">
                        </div>
                    </div>
                </div>
            </div>
            <!-- Featured Slider | END -->
        </header>
    </div>

        <button class="chatbot-toggler">
          <span class="material-symbols-rounded">mode_comment</span>
          <span class="material-symbols-outlined">close</span>
        </button>
        <div class="chatbot">
          <header>
            <h2>Ask Me Anything</h2>
            <span class="close-btn material-symbols-outlined">close</span>
          </header>
          <ul class="chatbox">
            <li class="chat incoming">
              <span class="material-symbols-outlined">smart_toy</span>
              <p>Hi there ðŸ‘‹<br>How can I help you today?</p>
            </li>
          </ul>
          <div class="chat-input">
            <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
            <span id="send-btn" class="material-symbols-rounded">send</span>
          </div>
        </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        var d_array = [
            { month: 'January', days: 31 },
            { month: 'February', days: 29 },
            { month: 'March', days: 31 },
            { month: 'April', days: 30 },
            { month: 'May', days: 31 },
            { month: 'June', days: 30 },
            { month: 'July', days: 31 },
            { month: 'August', days: 31 },
            { month: 'September', days: 30 },
            { month: 'October', days: 31 },
            { month: 'November', days: 30 },
            { month: 'December', days: 31 },
        ];

        function handleLocal() {
            document.querySelector('.client-type').style.display = 'none';
            document.getElementById('residentForm').style.display = 'block';
        }

        function handleFormSubmit(event) {
            event.preventDefault();
            $('.nic-validate-btn').click();
            
            const dob = document.getElementById('dob').value;
            const dobError = document.getElementById('dobError');
            
            if (!dob) {
                dobError.style.display = 'block';
            } else {
                dobError.style.display = 'none';
                if ($('.nic-validate-error').html() === '') {
                    window.location.href = 'checkavailabilitylocal.html';
                }
            }
        }

        $('.nic-validate-btn').click(function() {
            $('.nic-validate-error').html('');
            $('.nic-birthday').html('');
            $('.nic-gender').html('');
            var nicNumber = $('.nic-validate').val();
            var dob = $('#dob').val();
            if (validation(nicNumber, dob)) {
                var extractedData = extractData(nicNumber);
                var days = extractedData.dayList;
                var findedData = findDayANDGender(days, d_array);
                var month = findedData.month;
                var year = extractedData.year;
                var day = findedData.day;
                var gender = findedData.gender;
                var bday = day + '-' + month + '-' + year;
                var birthday = new Date(bday.replace(/(\d{2})-(\d{2})-(\d{4})/, "$2/$1/$3"));
                var birthday = getFormattedDate(birthday);
                $('.nic-birthday').html('Birthday: ' + birthday);
                $('.nic-gender').html('Gender: ' + gender);
            } else {
                $('.nic-validate-error').html('The NIC Number does not match the given Date of Birth');
            }
        });

        $('.nic-clear-btn').click(function() {
            $('.nic-validate-error').html('');
            $('.nic-birthday').html('');
            $('.nic-gender').html('');
            $('.nic-validate').val('');
            $('#dob').val('');
            $('#dobError').hide();
        });

        function findDayANDGender(days, d_array) {
            var dayList = parseInt(days);
            var month = '';
            var result = { day: '', month: '', gender: '' };
            if (dayList < 500) {
                result.gender = 'Male';
            } else {
                result.gender = 'Female';
                dayList = dayList - 500;
            }

            for (let i = 0; i < d_array.length; i++) {
                if (dayList <= d_array[i].days) {
                    result.day = dayList;
                    result.month = d_array[i].month;
                    break;
                } else {
                    dayList = dayList - d_array[i].days;
                }
            }
            return result;
        }

        function getFormattedDate(date) {
            var year = date.getFullYear();
            var month = (1 + date.getMonth()).toString().padStart(2, '0');
            var day = date.getDate().toString().padStart(2, '0');
            return month + '/' + day + '/' + year;
        }

        function extractData(nic) {
            var newNic = nic.replace(/[x|X|v|V]/, '');
            var nicNumber = newNic.length;
            var year = '';
            var dayList = '';
            if (nicNumber === 9) {
                year = '19' + newNic.substring(0, 2);
                dayList = newNic.substring(2, 5);
            } else {
                year = newNic.substring(0, 4);
                dayList = newNic.substring(4, 7);
            }
            return { year: year, dayList: dayList };
        }

        function validation(nic, dob) {
            var dob = new Date(dob);
            var year = dob.getFullYear();
            var month = dob.getMonth() + 1;
            var day = dob.getDate();
            var regularExpression = /^(([5-9])(\d)([0,1,2,3,5-8])(\d{6})([vVxX]))|(([12])(\d)(\d{2})([0,1,2,3,5-8])(\d{7}))/gm;
            var newNic = nic.match(regularExpression);
            var extractedData = extractData(nic);
            var days = extractedData.dayList;
            var findedData = findDayANDGender(days, d_array);
            var month1 = findedData.month;
            var year1 = extractedData.year;
            var day1 = findedData.day;
            if (newNic !== null && year === parseInt(year1) && day === day1) {
                return true;
            } else {
                return false;
            }
        }
    </script>
</body>
</html>
